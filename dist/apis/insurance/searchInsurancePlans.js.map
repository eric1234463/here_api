{"version":3,"sources":["../../../src/apis/insurance/searchInsurancePlans.js"],"names":["req","res","next","patientHealthStatus","findAll","where","patientId","body","order","limit","userHealthStatus","condtion","search","provider","$eq","surgery_cover","$gte","daliy_cover","InsurancePlan","insurancePlans","result","map","insuranceUserPlan","insurancePlan","dataValues","similarity","Math","ceil","value","rank","json","searchInsurancePlans"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;;;;sFAEe,iBAAoCA,GAApC,EAAyCC,GAAzC,EAA8CC,IAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACkB,iBAAOC,mBAAP,CAA2BC,OAA3B,CAAmC;AAChEC,qBAAO;AACLC,2BAAWN,IAAIO,IAAJ,CAASD;AADf,eADyD;AAIhEE,qBAAO,CAAC,CAAC,WAAD,EAAc,MAAd,CAAD,CAJyD;AAKhEC,qBAAO;AALyD,aAAnC,CADlB;;AAAA;AACPC,4BADO;AASTC,oBATS,GASE;AACbH,qBAAO,CAAC,CAAC,IAAD,EAAO,KAAP,CAAD,CADM;AAEbH,qBAAO;AAFM,aATF;;;AAcb,gBAAI,CAAC,CAACL,IAAIO,IAAJ,CAASK,MAAT,CAAgBC,QAAtB,EAAgC;AAC9BF,uBAAS,OAAT,EAAkB,UAAlB,IAAgC;AAC9BG,qBAAKd,IAAIO,IAAJ,CAASK,MAAT,CAAgBC;AADS,eAAhC;AAGD;;AAED,gBAAI,CAAC,CAACb,IAAIO,IAAJ,CAASK,MAAT,CAAgBG,aAAtB,EAAqC;AACnCJ,uBAAS,OAAT,EAAkB,eAAlB,IAAqC;AACnCK,sBAAMhB,IAAIO,IAAJ,CAASK,MAAT,CAAgBG;AADa,eAArC;AAGD;;AAED,gBAAI,CAAC,CAACf,IAAIO,IAAJ,CAASK,MAAT,CAAgBK,WAAtB,EAAmC;AACjCN,uBAAS,OAAT,EAAkB,aAAlB,IAAmC;AACjCK,sBAAMhB,IAAIO,IAAJ,CAASK,MAAT,CAAgBK;AADW,eAAnC;AAGD;;AA9BY;AAAA,mBAgCgB,iBAAOC,aAAP,CAAqBd,OAArB,CAA6BO,QAA7B,CAhChB;;AAAA;AAgCPQ,0BAhCO;AAkCPC,kBAlCO,GAkCED,eAAeE,GAAf,CAAmB,yBAAiB;AACjD,kBAAMC,+CACDC,cAAcC,UADb;AAEJC,4BAAYC,KAAKC,IAAL,CACVjB,iBAAiB,CAAjB,EAAoBc,UAApB,CAA+BI,KAA/B,GACEL,cAAcC,UAAd,CAAyBK,IAD3B,GAEE,GAHQ;AAFR,gBAAN;AAQA,qBAAOP,iBAAP;AACD,aAVc,CAlCF;;;AA8CbrB,gBAAI6B,IAAJ,CAASV,MAAT;;AA9Ca;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;WAAeW,oB;;;;SAAAA,oB","file":"searchInsurancePlans.js","sourcesContent":["import models from \"../../../models\";\n\nexport default async function searchInsurancePlans(req, res, next) {\n  const userHealthStatus = await models.patientHealthStatus.findAll({\n    where: {\n      patientId: req.body.patientId\n    },\n    order: [[\"createdAt\", \"DESC\"]],\n    limit: 1\n  });\n\n  let condtion = {\n    order: [[\"id\", \"ASC\"]],\n    where: {}\n  };\n\n  if (!!req.body.search.provider) {\n    condtion[\"where\"][\"provider\"] = {\n      $eq: req.body.search.provider\n    };\n  }\n\n  if (!!req.body.search.surgery_cover) {\n    condtion[\"where\"][\"surgery_cover\"] = {\n      $gte: req.body.search.surgery_cover\n    };\n  }\n\n  if (!!req.body.search.daliy_cover) {\n    condtion[\"where\"][\"daliy_cover\"] = {\n      $gte: req.body.search.daliy_cover\n    };\n  }\n\n  const insurancePlans = await models.InsurancePlan.findAll(condtion);\n\n  const result = insurancePlans.map(insurancePlan => {\n    const insuranceUserPlan = {\n      ...insurancePlan.dataValues,\n      similarity: Math.ceil(\n        userHealthStatus[0].dataValues.value /\n          insurancePlan.dataValues.rank *\n          100\n      )\n    };\n    return insuranceUserPlan;\n  });\n\n  res.json(result);\n}\n"]}