{"version":3,"sources":["../../../src/apis/insurance/getInsurancePlans.js"],"names":["req","res","next","patientHealthStatus","findAll","where","patientId","query","order","limit","userHealthStatus","InsurancePlan","insurancePlans","result","map","insuranceUserPlan","insurancePlan","dataValues","similarity","Math","ceil","value","rank","json","getInsurancePlans"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;;;;sFAEe,iBAAiCA,GAAjC,EAAsCC,GAAtC,EAA2CC,IAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACkB,iBAAOC,mBAAP,CAA2BC,OAA3B,CAAmC;AAChEC,qBAAO;AACLC,2BAAWN,IAAIO,KAAJ,CAAUD;AADhB,eADyD;AAIhEE,qBAAO,CAAC,CAAC,WAAD,EAAc,MAAd,CAAD,CAJyD;AAKhEC,qBAAO;AALyD,aAAnC,CADlB;;AAAA;AACPC,4BADO;AAAA;AAAA,mBASgB,iBAAOC,aAAP,CAAqBP,OAArB,CAA6B;AACxDI,qBAAO,CAAC,CAAC,MAAD,EAAS,MAAT,CAAD,EAAmB,CAAC,IAAD,EAAO,KAAP,CAAnB;AADiD,aAA7B,CAThB;;AAAA;AASPI,0BATO;AAaPC,kBAbO,GAaED,eAAeE,GAAf,CAAmB,yBAAiB;AACjD,kBAAMC,+CACDC,cAAcC,UADb;AAEJC,4BAAYC,KAAKC,IAAL,CACVV,iBAAiB,CAAjB,EAAoBO,UAApB,CAA+BI,KAA/B,GACEL,cAAcC,UAAd,CAAyBK,IAD3B,GAEE,GAHQ;AAFR,gBAAN;AAQA,qBAAOP,iBAAP;AACD,aAVc,CAbF;;;AAyBbd,gBAAIsB,IAAJ,CAASV,MAAT;;AAzBa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;WAAeW,iB;;;;SAAAA,iB","file":"getInsurancePlans.js","sourcesContent":["import models from \"../../../models\";\n\nexport default async function getInsurancePlans(req, res, next) {\n  const userHealthStatus = await models.patientHealthStatus.findAll({\n    where: {\n      patientId: req.query.patientId\n    },\n    order: [[\"createdAt\", \"DESC\"]],\n    limit: 1\n  });\n\n  const insurancePlans = await models.InsurancePlan.findAll({\n    order: [[\"rank\", \"DESC\"], [\"id\", \"ASC\"]]\n  });\n\n  const result = insurancePlans.map(insurancePlan => {\n    const insuranceUserPlan = {\n      ...insurancePlan.dataValues,\n      similarity: Math.ceil(\n        userHealthStatus[0].dataValues.value /\n          insurancePlan.dataValues.rank *\n          100\n      )\n    };\n    return insuranceUserPlan;\n  });\n\n  res.json(result);\n}\n"]}