{"version":3,"sources":["../../../src/apis/insurance/getInsurancePlans.js"],"names":["req","res","next","query","patientId","userAvgHealthRank","InsurancePlan","findAll","order","insurancePlans","result","map","insuranceUserPlan","insurancePlan","dataValues","similarity","Math","ceil","rank","sortedResult","sort","a","b","json","getInsurancePlans"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;;sFAEe,iBAAiCA,GAAjC,EAAsCC,GAAtC,EAA2CC,IAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEmB,sCAAuBF,IAAIG,KAAJ,CAAUC,SAAjC,CAFnB;;AAAA;AAEPC,6BAFO;AAAA;AAAA,mBAIgB,iBAAOC,aAAP,CAAqBC,OAArB,CAA6B;AACxDC,qBAAO,CAAC,CAAC,MAAD,EAAS,MAAT,CAAD,EAAmB,CAAC,IAAD,EAAO,KAAP,CAAnB;AADiD,aAA7B,CAJhB;;AAAA;AAIPC,0BAJO;AAQPC,kBARO,GAQED,eAAeE,GAAf,CAAmB,yBAAiB;AACjD,kBAAMC,+CACDC,cAAcC,UADb;AAEJC,4BAAYC,KAAKC,IAAL,CACVZ,oBACEQ,cAAcC,UAAd,CAAyBI,IAD3B,GAEE,GAHQ;AAFR,gBAAN;AAQA,qBAAON,iBAAP;AACD,aAVc,CARF;AAoBPO,wBApBO,GAoBQT,OAAOU,IAAP,CAAY,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACzC,qBAAOA,EAAEP,UAAF,GAAeM,EAAEN,UAAxB;AACD,aAFoB,CApBR;;;AAwBbd,gBAAIsB,IAAJ,CAASJ,YAAT;;AAxBa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;WAAeK,iB;;;;SAAAA,iB","file":"getInsurancePlans.js","sourcesContent":["import models from \"../../../models\";\nimport getUserAvgHealthStatus from './getUserAvgHealthStatus';\n\nexport default async function getInsurancePlans(req, res, next) {\n  \n  const userAvgHealthRank = await getUserAvgHealthStatus(req.query.patientId);\n  \n  const insurancePlans = await models.InsurancePlan.findAll({\n    order: [[\"rank\", \"DESC\"], [\"id\", \"ASC\"]]\n  });\n\n  const result = insurancePlans.map(insurancePlan => {\n    const insuranceUserPlan = {\n      ...insurancePlan.dataValues,\n      similarity: Math.ceil(\n        userAvgHealthRank /\n          insurancePlan.dataValues.rank *\n          100\n      )\n    };\n    return insuranceUserPlan;\n  });\n\n  const sortedResult = result.sort((a, b) => {\n    return b.similarity - a.similarity;\n  });\n\n  res.json(sortedResult);\n}\n"]}